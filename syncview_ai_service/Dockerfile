# SyncView AI Service - Dockerfile
# Cloud Run ë°°í¬ìš© (ëª¨ë¸ ì‚¬ì „ ë‹¤ìš´ë¡œë“œ)

FROM python:3.10-slim

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# ì‹œìŠ¤í…œ ì˜ì¡´ì„± ì„¤ì¹˜
RUN apt-get update && apt-get install -y \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Python ì˜ì¡´ì„± ë³µì‚¬ ë° ì„¤ì¹˜
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ ë³µì‚¬
COPY main.py .

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# ğŸ”¥ í•µì‹¬: ëª¨ë¸ ì‚¬ì „ ë‹¤ìš´ë¡œë“œ (ë¹Œë“œ ì‹œ 1íšŒë§Œ ì‹¤í–‰)
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
RUN python -c "\
from transformers import pipeline, AutoTokenizer, AutoModelForSeq2SeqLM; \
print('ğŸ“¥ ëª¨ë¸ ë‹¤ìš´ë¡œë“œ ì‹œì‘...'); \
print('1ï¸âƒ£ ê°ì„± ë¶„ì„ ëª¨ë¸...'); \
pipeline('sentiment-analysis', model='distilbert-base-uncased-finetuned-sst-2-english'); \
print('2ï¸âƒ£ ìš”ì•½ ëª¨ë¸...'); \
pipeline('summarization', model='sshleifer/distilbart-cnn-12-6'); \
print('3ï¸âƒ£ ë²ˆì—­ ëª¨ë¸...'); \
AutoTokenizer.from_pretrained('facebook/nllb-200-distilled-600M'); \
AutoModelForSeq2SeqLM.from_pretrained('facebook/nllb-200-distilled-600M'); \
print('âœ… ëª¨ë“  ëª¨ë¸ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!'); \
"

# í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
ENV TRANSFORMERS_CACHE=/app/.cache
ENV PORT=8080

# í¬íŠ¸ ë…¸ì¶œ
EXPOSE 8080

# ì„œë²„ ì‹¤í–‰
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8080"]

